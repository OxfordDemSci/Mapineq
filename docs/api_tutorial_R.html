<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Doug Leasure">
<meta name="dcterms.date" content="2024-12-13">

<title>Querying the Mapineq API with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="api_tutorial_R_files/libs/clipboard/clipboard.min.js"></script>
<script src="api_tutorial_R_files/libs/quarto-html/quarto.js"></script>
<script src="api_tutorial_R_files/libs/quarto-html/popper.min.js"></script>
<script src="api_tutorial_R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="api_tutorial_R_files/libs/quarto-html/anchor.min.js"></script>
<link href="api_tutorial_R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="api_tutorial_R_files/libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="api_tutorial_R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="api_tutorial_R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="api_tutorial_R_files/libs/bootstrap/bootstrap-207e17f1a70ca2c9891d2c9981023b9d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<link href="api_tutorial_R_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="api_tutorial_R_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="api_tutorial_R_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="api_tutorial_R_files/libs/datatables-binding-0.33/datatables.js"></script>

<script src="api_tutorial_R_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="api_tutorial_R_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="api_tutorial_R_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="api_tutorial_R_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="api_tutorial_R_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="api_tutorial_R_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  </ul></li>
  <li><a href="#fetch-sources-by-nuts-level" id="toc-fetch-sources-by-nuts-level" class="nav-link" data-scroll-target="#fetch-sources-by-nuts-level">1. Fetch Sources by NUTS Level</a></li>
  <li><a href="#retrieve-years-and-nuts-levels-available-for-a-data-source" id="toc-retrieve-years-and-nuts-levels-available-for-a-data-source" class="nav-link" data-scroll-target="#retrieve-years-and-nuts-levels-available-for-a-data-source">2. Retrieve Years and NUTS Levels Available for a Data Source</a></li>
  <li><a href="#identify-data-filters-available-for-a-data-source" id="toc-identify-data-filters-available-for-a-data-source" class="nav-link" data-scroll-target="#identify-data-filters-available-for-a-data-source">3. Identify Data Filters Available for a Data Source</a></li>
  <li><a href="#query-data-for-one-data-source" id="toc-query-data-for-one-data-source" class="nav-link" data-scroll-target="#query-data-for-one-data-source">4. Query Data for One Data Source</a></li>
  <li><a href="#query-data-from-two-sources-joined-by-location" id="toc-query-data-from-two-sources-joined-by-location" class="nav-link" data-scroll-target="#query-data-from-two-sources-joined-by-location">5. Query Data from Two Sources Joined by Location</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Querying the Mapineq API with R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Doug Leasure </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 13, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<nav class="navbar">
<div class="navbar-left">
<pre><code>&lt;a href="index.html"&gt;&lt;img src="https://www.mapineq.org/wp-content/themes/mapineq/assets/images/logo_mapineq1.svg" alt="Mapineq" class="logo"&gt;&lt;/a&gt;
&lt;a href="index.html"&gt;Home&lt;/a&gt;
&lt;a href="case-studies.html"&gt;Case Studies&lt;/a&gt;
&lt;a href="research.html"&gt;Research&lt;/a&gt;
&lt;a href="data-catalogue.html"&gt;Data Catalogue&lt;/a&gt;</code></pre>
</div>
<div class="navbar-right">
<pre><code>&lt;a href="about-us.html"&gt;About Us&lt;/a&gt;
&lt;a href="contact.html"&gt;Contact&lt;/a&gt;</code></pre>
</div>
</nav>
<p><img src="https://www.mapineq.org/wp-content/themes/mapineq/assets/images/logo_mapineq1.svg" alt="Logo" class="logo"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This tutorial demonstrates how to query the Mapineq API using R. An API (Application Programming Interface) is a tool that allows your computer to communicate with a remote server. In this case, we will use it to automate data imports from the MapIneq database directly into your local R environment.</p>
<p>This tutorial covers the following topics:</p>
<ol type="1">
<li>Fetching a list of data sources available from the MapIneq database for a given geographic level (i.e.&nbsp;NUTS level).</li>
<li>Retrieving a list of years and geographic levels that are available for a data set.</li>
<li>Identifying the data filters that are available for a data set.</li>
<li>Querying data from a single data set.</li>
<li>Querying data from two data sets joined by location.</li>
</ol>
<p>We use the <strong>httr</strong> and <strong>jsonlite</strong> libraries for API requests and JSON processing, and the <strong>tidyr</strong> library for data wrangling.</p>
<p>Please note that the complete technical documentation for the API is available from <a href="https://mapineq.org/data-users">https://mapineq.org/data-users</a>.</p>
<hr>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<section id="load-r-libraries" class="level4">
<h4 class="anchored" data-anchor-id="load-r-libraries">Load R Libraries</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># required for API queries</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># required for data wrangling</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># required to nicely format the quarto doc</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="api-base-url" class="level4">
<h4 class="anchored" data-anchor-id="api-base-url">API Base URL</h4>
<p>Let’s start by defining the base URL for the Mapineq API:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://api.mapineq.org"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>What follows is a series of steps to identify a data source and its characteristics and then query data from that source.</p>
</section>
</section>
</section>
<section id="fetch-sources-by-nuts-level" class="level2">
<h2 class="anchored" data-anchor-id="fetch-sources-by-nuts-level">1. Fetch Sources by NUTS Level</h2>
<p>Now, let’s get a list of data that are available in the Mapineq database for a given geographic level.</p>
<p>We will use NUTS administrative units to define geographic levels. NUTS regions are standardised administrative boundaries for Europe. NUTS level-0 are country boundaries, NUTS level-1 are the largest subnational administrative units and NUTS level-3 are the smallest subnational administrative units.</p>
<p>Let’s take a look at how to get a list of all data available in the Mapineq database for NUTS level-2. We will do this by querying the Mapineq API endpoint <a href="https://www.mapineq.org/data-users/#get_source_by_nuts_level"><strong>get_source_by_nuts_level</strong></a>.</p>
<p>The first step is to select the API endpoint that we want to query and to define our values for its parameters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the API endpoint to query</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> <span class="st">"functions/postgisftw.get_source_by_nuts_level/items.json"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Provide parameters required by the endpoint</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">_level</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="co"># define the geographic level (i.e. NUTS level)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">limit =</span> <span class="dv">500</span>  <span class="co"># limit response to this many data sets</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that we defined the parameters to retrieve the data catalogue for NUTS level-2 and to limit the response to include no more than 500 data sets.</p>
<p>Now, we are ready to submit our API request:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Submit HTTP GET request to query the API</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url =</span> url, <span class="at">path =</span> endpoint, <span class="at">query =</span> params)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">status_code</span>(response) <span class="sc">==</span> <span class="dv">200</span>) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(response)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="fu">status_code</span>(response))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://api.mapineq.org/functions/postgisftw.get_source_by_nuts_level/items.json?_level=2&amp;limit=500]
  Date: 2024-12-13 21:44
  Status: 200
  Content-Type: application/json
  Size: 27.1 kB</code></pre>
</div>
</div>
<p>The API response should have an http status code of 200 which indicates that our API request was successful. The response contains the data list that we want in JSON format, so we now need to do some data wrangling to convert this into a data.frame object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON to data frame</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_content <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">"text"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the data</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df_content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-00679ec2b240941d0c2d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-00679ec2b240941d0c2d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162"],["All causes of death by NUTS 2 regions (ESTAT)","Area by NUTS 3 region (ESTAT)","At-risk-of-poverty rate by NUTS 2 regions (ESTAT)","Available beds in hospitals by NUTS 2 region (ESTAT)","Available beds in hospitals by NUTS 2 regions (ESTAT)","Average of the Gross Building Height (Global Human Settlement Layer)","Average of the Net Building Height (Global Human Settlement Layer)","Business demography and high growth enterprise by NACE Rev. 2 and NUTS 3 regions (ESTAT)","Business demography by size class and NUTS 3 regions (ESTAT)","Causes of death by NUTS 2 region - absolute number, 3 year average - females (ESTAT)","Causes of death by NUTS 2 region - absolute number, 3 year average - males (ESTAT)","Causes of death by NUTS 2 region - absolute number, 3 year average - total (ESTAT)","Causes of death by NUTS 2 region - crude death rate (ESTAT)","Causes of death by NUTS 2 region - crude death rate, 3 year average - females (ESTAT)","Causes of death by NUTS 2 region - crude death rate, 3 year average - males (ESTAT)","Causes of death by NUTS 2 region - crude death rate, 3 year average - total (ESTAT)","Causes of death by NUTS 2 region - standardised death rate, 3 year average (ESTAT)","Causes of death - crude death rate by NUTS 2 region of residence (ESTAT)","Causes of death - infant mortality by NUTS 2 region of occurrence, 3 year average (ESTAT)","Causes of death - infant mortality by NUTS 2 region of residence, 3 year average (ESTAT)","Causes of death - standardised death rate by NUTS 2 region of residence (ESTAT)","Causes of death - standardised death rate by NUTS 2 region of residence, 3 year average (ESTAT)","Causes of death - years and potential years of life lost by NUTS 2 region of residence, 3 year average (ESTAT)","Conventional dwellings by occupancy status, type of building and NUTS 3 region (ESTAT)","Crimes recorded by the police by NUTS 3 regions (ESTAT)","Database on Migrants in OECD Regions (OECD)","Death due to accidents by NUTS 2 region (ESTAT)","Death due to cancer by NUTS 2 regions (ESTAT)","Death due to ischaemic heart diseases by NUTS 2 region (ESTAT)","Death due to transport accidents by NUTS 2 region (ESTAT)","Deaths by age group, sex and NUTS 3 region (ESTAT)","Deaths by age, sex and NUTS 2 region (ESTAT)","Deaths by week and NUTS 3 region (ESTAT)","Deaths by week, sex, 10-year age group and NUTS 2 region (ESTAT)","Deaths by week, sex, 20-year age group and NUTS 2 region (ESTAT)","Deaths by week, sex, 5-year age group and NUTS 2 region (ESTAT)","Deaths by week, sex and NUTS 2 region (ESTAT)","Deaths by week, sex and NUTS 3 region (ESTAT)","Deaths (total) by NUTS 3 region (ESTAT)","Distribution of pupils and students enrolled in general and vocational programmes by education level and NUTS 2 region (ESTAT)","Early leavers from education and training by sex and NUTS 2 region (ESTAT)","Education indicators by NUTS 2 region (ESTAT)","Employer business demography by NACE Rev. 2 and NUTS 3 regions (ESTAT)","Employer business demography by size class and NUTS 3 regions (ESTAT)","Employment by sex, age, educational attainment level and NUTS 2 regions (1 000) (ESTAT)","Employment rates of young people not in education and training by sex, educational attainment level, years since completion of highest level of education and NUTS 2 region (ESTAT)","Families by type, size and NUTS 3 region (ESTAT)","Fertility indicators by NUTS 2 region (ESTAT)","Fertility indicators by NUTS 3 region (ESTAT)","Fertility rates by age and NUTS 2 region (ESTAT)","Fetal, peri- and neonatal mortality rates by NUTS 2 region of occurrence, 3 year average (ESTAT)","GERD by sector of performance and NUTS 2 regions (ESTAT)","Health personnel by NUTS 2 regions - historical data (1993-2021) (ESTAT)","Hospital beds by NUTS 2 region– historical data (1993-2016) (ESTAT)","Hospital days of in-patients by NUTS 2 region - females (ESTAT)","Hospital days of in-patients by NUTS 2 region - males (ESTAT)","Hospital days of in-patients by NUTS 2 region - total (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, day cases, per 100 000 inhabitants - females (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, day cases, per 100 000 inhabitants - males (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, day cases, per 100 000 inhabitants - total (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, day cases, total number - females (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, day cases, total number - males (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, day cases, total number - total (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, in-patients, per 100 000 inhabitants - females (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, in-patients, per 100 000 inhabitants - males (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, in-patients, per 100 000 inhabitants - total (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, in-patients, total number - males (ESTAT)","Hospital discharges by diagnosis and NUTS 2 region, in-patients, total number - total (ESTAT)","Hospital discharges by diagnosis, NUTS 2 region, in-patients and total number - females (ESTAT)","Impact of social transfers (excluding pensions) on poverty reduction by sex and NUTS 2 regions (ESTAT)","Individuals regularly using the internet by NUTS 2 regions (ESTAT)","Infant mortality by NUTS 2 region (ESTAT)","Infant mortality rates by NUTS 2 region (ESTAT)","In-patient average length of stay (days) by NUTS 2 region - females (ESTAT)","In-patient average length of stay (days) by NUTS 2 region - males (ESTAT)","In-patient average length of stay (days) by NUTS 2 region - total (ESTAT)","Internet speed by ookla (Ookla)","Life expectancy at birth by sex and NUTS 2 region (ESTAT)","Life expectancy by age, sex and NUTS 2 region (ESTAT)","Live births by age group of the mothers and NUTS 3 region (ESTAT)","Live births by mother's age and NUTS 2 region (ESTAT)","Live births (total) by NUTS 3 region (ESTAT)","Long-term care beds in nursing and residential care facilities by NUTS 2 region - historical data (1980-2021) (ESTAT)","Long-term unemployment (12 months and more) by sex, age, educational attainment level and NUTS 2 regions (%) (ESTAT)","Long-term unemployment rate (12 months and more) by NUTS 2 regions (ESTAT)","Morphological Settlement Zone delineation and inner classification (Global Human Settlement Layer)","Motorways network by NUTS 2 regions (ESTAT)","Non-/residential functional classification of the built domain (Global Human Settlement Layer)","Participation rate in education and training (last 4 weeks) by NUTS 2 region (ESTAT)","People at risk of poverty or social exclusion by NUTS 2 regions (ESTAT)","Peri-neonatal mortality by age of mother and parity, by NUTS2 region of residence and occurrence, 3 year average (ESTAT)","Persons at risk of poverty or social exclusion by NUTS regions - EU 2020 strategy (ESTAT)","Physicians by NUTS2 region (ESTAT)","PM2.5 Satellite-derived particulate matter in the air (&lt;2.5 micrometers) (Washington University in St. Louis)","Population by broad age group and NUTS 3 regions (ESTAT)","Population by current activity status, educational attainment level and NUTS 2 region (ESTAT)","Population by educational attainment level, sex, age, citizenship and NUTS 2 regions (%) (ESTAT)","Population by educational attainment level, sex, age, country of birth and NUTS 2 region (%) (ESTAT)","Population by educational attainment level, sex and NUTS 2 regions (%) (ESTAT)","Population by family status and NUTS 3 region (ESTAT)","Population by group of citizenship, occupation and NUTS 2 region (ESTAT)","Population by group of country of birth, current activity status and NUTS 2 region (ESTAT)","Population by group of country of birth, educational attainment level and NUTS 2 region (ESTAT)","Population by group of country of birth, occupation and NUTS 2 region (ESTAT)","Population by housing arrangement and NUTS 2 region (ESTAT)","Population by marital status and NUTS 3 region (ESTAT)","Population by period of arrival in the country, country of birth and NUTS 2 region (ESTAT)","Population by single year of age and NUTS 3 region (ESTAT)","Population change by NUTS 2 region - Crude rates of total change, natural change and net migration plus adjustment (ESTAT)","Population change - Demographic balance and crude rates at regional level (NUTS 3)  (ESTAT)","Population density by NUTS 2 region (ESTAT)","Population density by NUTS 3 region (ESTAT)","Population on 1 January by age group, sex and NUTS 2 region (ESTAT)","Population on 1 January by age, sex and NUTS 2 region (ESTAT)","Population with Ukrainian citizenship by 5-year age group and NUTS3 region (ESTAT)","Population with Ukrainian citizenship by age and NUTS 3 region (ESTAT)","Prevalence of disability by sex, economic activity (NACE Rev. 1) and NUTS 2 region (ESTAT)","Private households by type, tenure status and NUTS 2 region (ESTAT)","Pupils and students enrolled by education level, sex and NUTS2 region (ESTAT)","Pupils and students enrolled by sex, age and NUTS 2 region (ESTAT)","Pupils enrolled in early childhood education by sex and NUTS2 region (ESTAT)","Pupils enrolled in lower-secondary education by programme orientation, sex and NUTS 2 region (ESTAT)","Pupils enrolled in post-secondary non-tertiary education by programme orientation, sex and NUTS 2 region (ESTAT)","Pupils enrolled in primary education by sex and NUTS2 region (ESTAT)","Pupils enrolled in upper secondary education by programme orientation, sex and NUTS 2 region (ESTAT)","Pupils from age 3 to the starting age of compulsory education at primary level by NUTS 2 region - % of the population of the corresponding age (ESTAT)","Pupils from age 4 to the starting age of compulsory education at primary level by NUTS 2 region - % of the population of the corresponding age (ESTAT)","Rail network by NUTS 2 regions (ESTAT)","Ratio of the proportion of tertiary students over the proportion of the population by NUTS 1 and NUTS 2 region (ESTAT)","Regional Business Demography (OECD)","Regional Demography (OECD)","Regional Economy (OECD)","Regional Innovation (OECD)","Regional Labour (OECD)","Regional Social and Environmental indicators (OECD)","Regional Well-Being (OECD)","Road, rail and navigable inland waterways networks by NUTS 2 regions (ESTAT)","Self-reported unmet needs for medical examination by main reason declared and NUTS 2 region (ESTAT)","Settlement typology by population density and built-up surface classification (Global Human Settlement Layer)","Severe material and social deprivation by NUTS region (ESTAT)","Short-term regional statistics (OECD)","Students by age, sex and NUTS 2 region (ESTAT)","Students by level of education, orientation, sex and NUTS 2 region (ESTAT)","Students enrolled in tertiary education by education level, programme orientation, sex and NUTS 2 region (ESTAT)","Tertiary educational attainment, age group 25-64 by sex and NUTS 2 region (ESTAT)","Total fertility rate by NUTS 2 region (ESTAT)","Unemployment by sex, age, citizenship and NUTS 2 regions (ESTAT)","Unemployment by sex, age, country of birth and NUTS 2 regions (ESTAT)","Unemployment by sex, age, educational attainment level and NUTS 2 regions (1 000) (ESTAT)","Unemployment rate by NUTS 2 regions (ESTAT)","Unemployment rates by sex, age, citizenship and NUTS 2 regions (ESTAT)","Unemployment rates by sex, age, country of birth and NUTS 2 regions (ESTAT)","Unemployment rates by sex, age, educational attainment level and NUTS 2 regions (%) (ESTAT)","Urban green area (Urban Atlas)","Victims in road accidents by NUTS 2 region (ESTAT)","Young people neither in employment nor in education and training by sex, age, citizenship and NUTS 2 region (NEET rates) (ESTAT)","Young people neither in employment nor in education and training by sex, age, country of birth and NUTS 2 region (NEET rates) (ESTAT)","Young people neither in employment nor in education and training by sex and NUTS 2 regions (NEET rates) (ESTAT)","Youth employment rate by sex, age and NUTS 2 regions (ESTAT)","Youth long-term unemployment rate (12 months or longer) by sex, age and NUTS 2 regions (ESTAT)","Youth unemployment rate by sex, age and NUTS 2 regions (ESTAT)","Youth unemployment ratio by sex, age and NUTS 2 regions (ESTAT)"],["TGS00057","DEMO_R_D3AREA","TGS00103","HLTH_RS_BDSRG2","TGS00064","ghs_built_h_agbh","ghs_built_h_anbh","BD_HGNACE2_R3","BD_SIZE_R3","HLTH_CD_YNRF","HLTH_CD_YNRM","HLTH_CD_YNRT","HLTH_CD_ACDR","HLTH_CD_YCDRF","HLTH_CD_YCDRM","HLTH_CD_YCDRT","HLTH_CD_YSDR1","HLTH_CD_ACDR2","HLTH_CD_YINFO","HLTH_CD_YINFR","HLTH_CD_ASDR2","HLTH_CD_YSDR2","HLTH_CD_YPYLL","CENS_11DWOB_R3","CRIM_GEN_REG","REGION_MIGRANTS","TGS00060","TGS00058","TGS00059","TGS00061","DEMO_R_MAGEC3","DEMO_R_MAGEC","DEMO_R_MWK3_T","DEMO_R_MWK2_10","DEMO_R_MWK2_20","DEMO_R_MWK2_05","DEMO_R_MWK2_TS","DEMO_R_MWK3_TS","DEMO_R_DEATHS","EDUC_UOE_ENRA13","EDAT_LFSE_16","EDUC_REGIND","BD_ENACE2_R3","BD_ESIZE_R3","LFST_R_LFE2EEDU","EDAT_LFSE_33","CENS_11FTS_R3","DEMO_R_FIND2","DEMO_R_FIND3","DEMO_R_FRATE2","HLTH_CD_YPERRTO","RD_E_GERDREG","HLTH_RS_PRSRG","HLTH_RS_BDSRG","HLTH_CO_HOSDAYF","HLTH_CO_HOSDAYM","HLTH_CO_HOSDAYT","HLTH_CO_DISCH4F","HLTH_CO_DISCH4M","HLTH_CO_DISCH4T","HLTH_CO_DISCH3F","HLTH_CO_DISCH3M","HLTH_CO_DISCH3T","HLTH_CO_DISCH2F","HLTH_CO_DISCH2M","HLTH_CO_DISCH2T","HLTH_CO_DISCH1M","HLTH_CO_DISCH1T","HLTH_CO_DISCH1F","TESPM050_R","TGS00050","DEMO_R_MINF","DEMO_R_MINFIND","HLTH_CO_INPSTF","HLTH_CO_INPSTM","HLTH_CO_INPSTT","ookla","TGS00101","DEMO_R_MLIFEXP","DEMO_R_FAGEC3","DEMO_R_FAGEC","DEMO_R_BIRTHS","HLTH_RS_BDSNS","LFST_R_LFU2LTU","TGS00053","ghs_c_msz","TGS00114","ghs_c_fun","TRNG_LFSE_04","TGS00107","HLTH_CD_YPERRO","ILC_PEPS11","HLTH_RS_PHYSREG","pm25","CENS_21AGR3","CENS_11AED_R2","EDAT_LFS_9918","EDAT_LFS_9917","EDAT_LFSE_04","CENS_11FS_R3","CENS_11CTZO_R2","CENS_11COBA_R2","CENS_11COBE_R2","CENS_11COBO_R2","CENS_11HOU_R2","CENS_11MS_R3","CENS_11ARCO_R2","CENS_11AG_R3","TGS00099","DEMO_R_GIND3","TGS00024","DEMO_R_D3DENS","DEMO_R_PJANGROUP","DEMO_R_D2JAN","CENS_21UA_A5R3","CENS_21UA_AR3","HLTH_DB_EMRENA","CENS_11HTTS_R2","EDUC_UOE_ENRA11","EDUC_UOE_ENRA12","EDUC_UOE_ENRP03","EDUC_UOE_ENRS03","EDUC_UOE_ENRS09","EDUC_UOE_ENRP06","EDUC_UOE_ENRS06","EDUC_UOE_ENRA22","EDUC_UOE_ENRA17","TGS00113","EDUC_UOE_ENRT05","REG_BUSI_DEMOG","REGION_DEMOGR","REGION_ECONOM","REGION_INNOVATION","REGION_LABOUR","REGION_SOCIAL","RWB","TRAN_R_NET","HLTH_SILC_08_R","ghs_smod","ILC_MDSD18","REGION_ST","EDUC_RENRLRG3","EDUC_RENRLRG1","EDUC_UOE_ENRT06","TGS00109","TGS00100","LFST_R_LFU2GAN","LFST_R_LFU2GAC","LFST_R_LFU3PERS","TGS00010","LFST_R_LFUR2GAN","LFST_R_LFUR2GAC","LFST_R_LFU3RT","urban_green_area","TRAN_R_ACCI","EDAT_LFSE_38","EDAT_LFSE_37","EDAT_LFSE_22","YTH_EMPL_030","YTH_EMPL_130","YTH_EMPL_110","YTH_EMPL_140"],["All causes of death ","Area by NUTS 3 regio","At-risk-of-poverty r","Available beds in ho","Available beds in ho","ghs_built_h_agbh","ghs_built_h_anbh","Business demography ","Business demography ","Causes of death by N","Causes of death by N","Causes of death by N","Causes of death by N","Causes of death by N","Causes of death by N","Causes of death by N","Causes of death by N","Causes of death - cr","Causes of death - in","Causes of death - in","Causes of death - st","Causes of death - st","Causes of death - ye","Conventional dwellin","Crimes recorded by t","Database on Migrants","Death due to acciden","Death due to cancer ","Death due to ischaem","Death due to transpo","Deaths by age group,","Deaths by age, sex a","Deaths by week and N","Deaths by week, sex,","Deaths by week, sex,","Deaths by week, sex,","Deaths by week, sex ","Deaths by week, sex ","Deaths (total) by NU","Distribution of pupi","Early leavers from e","Education indicators","Employer business de","Employer business de","Employment by sex, a","Employment rates of ","Families by type, si","Fertility indicators","Fertility indicators","Fertility rates by a","Fetal, peri- and neo","GERD by sector of pe","Health personnel by ","Hospital beds by NUT","Hospital days of in-","Hospital days of in-","Hospital days of in-","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Hospital discharges ","Impact of social tra","Individuals regularl","Infant mortality by ","Infant mortality rat","In-patient average l","In-patient average l","In-patient average l","Ookla","Life expectancy at b","Life expectancy by a","Live births by age g","Live births by mothe","Live births (total) ","Long-term care beds ","Long-term unemployme","Long-term unemployme","ghs_c_msz","Motorways network by","ghs_c_fun","Participation rate i","People at risk of po","Peri-neonatal mortal","Persons at risk of p","Physicians by NUTS2 ","Air particulates","Population by broad ","Population by curren","Population by educat","Population by educat","Population by educat","Population by family","Population by group ","Population by group ","Population by group ","Population by group ","Population by housin","Population by marita","Population by period","Population by single","Population change by","Population change - ","Population density b","Population density b","Population on 1 Janu","Population on 1 Janu","Population with Ukra","Population with Ukra","Prevalence of disabi","Private households b","Pupils and students ","Pupils and students ","Pupils enrolled in e","Pupils enrolled in l","Pupils enrolled in p","Pupils enrolled in p","Pupils enrolled in u","Pupils from age 3 to","Pupils from age 4 to","Rail network by NUTS","Ratio of the proport","Regional Business De","Regional Demography","Regional Economy","Regional Innovation","Regional Labour","Regional Social and ","Regional Well-Being","Road, rail and navig","Self-reported unmet ","ghs_smod","Severe material and ","Short-term regional ","Students by age, sex","Students by level of","Students enrolled in","Tertiary educational","Total fertility rate","Unemployment by sex,","Unemployment by sex,","Unemployment by sex,","Unemployment rate by","Unemployment rates b","Unemployment rates b","Unemployment rates b","Urban green","Victims in road acci","Young people neither","Young people neither","Young people neither","Youth employment rat","Youth long-term unem","Youth unemployment r","Youth unemployment r"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>f_description<\/th>\n      <th>f_resource<\/th>\n      <th>f_short_description<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"f_description","targets":1},{"name":"f_resource","targets":2},{"name":"f_short_description","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We now have a nice searchable data frame that we can use to explore the data that are available in the Mapineq database.</p>
<hr>
</section>
<section id="retrieve-years-and-nuts-levels-available-for-a-data-source" class="level2">
<h2 class="anchored" data-anchor-id="retrieve-years-and-nuts-levels-available-for-a-data-source">2. Retrieve Years and NUTS Levels Available for a Data Source</h2>
<p>For this step, we will select a single data source that we want to investigate further. Let’s look at <strong>At-risk-of-poverty rate by NUTS 2 regions</strong> from EuroStat (ESTAT). You will notice from the data catalogue that we retrieved in the previous step that the resource ID for this data set is <strong>TGS00103</strong> which we will use for our next steps</p>
<p>To retrieve years and NUTS levels that are available for this data source, we will use the API endpoint <a href="https://www.mapineq.org/data-users/#get_year_nuts_level_from_source">get_year_nuts_level_from_source</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># API endpoint</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> <span class="st">"functions/postgisftw.get_year_nuts_level_from_source/items.json"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Endpoint parameters</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">_resource</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TGS00103"</span>  <span class="co"># resource ID of the data set</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># GET request to query API</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url =</span> url, <span class="at">path =</span> endpoint, <span class="at">query =</span> params)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the response status</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">status_code</span>(response) <span class="sc">==</span> <span class="dv">200</span>) {</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Error:"</span>, <span class="fu">status_code</span>(response)))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># API response as data.frame</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  df_content <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">"text"</span>))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the data</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df_content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b570d9fe66c86eb7c126" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b570d9fe66c86eb7c126">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10"],["2","2","2","2","2","2","2","2","2","2"],["2012","2013","2014","2015","2016","2017","2018","2019","2020","2021"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>f_level<\/th>\n      <th>f_year<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"f_level","targets":1},{"name":"f_year","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The API response provides all of the years and geographic-levels covered by this data set.</p>
<hr>
</section>
<section id="identify-data-filters-available-for-a-data-source" class="level2">
<h2 class="anchored" data-anchor-id="identify-data-filters-available-for-a-data-source">3. Identify Data Filters Available for a Data Source</h2>
<p>Many data sets available in the Mapineq database contain various data filters that can be applied to extract the data you are specifically interested in. These filters could include age, sex, education level, etc. Our next step is to identify which filters are avilable for the <strong>At-risk-of-poverty rate by NUTS 2 regions</strong> data that we are investigating.</p>
<p>To identify the filters that are available for this data source, we will use the API endpoint <a href="https://www.mapineq.org/data-users/#get_column_values_source_json">get_column_values_source_json</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># API endpoint</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> <span class="st">"functions/postgisftw.get_column_values_source_json/items.json"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Endpoint parameters</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">_resource</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TGS00103"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">source_selections =</span> <span class="fu">toJSON</span>(<span class="fu">list</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">year =</span> <span class="st">"2020"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">level =</span> <span class="st">"2"</span>, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">selected =</span> <span class="fu">list</span>()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">auto_unbox =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This endpoint requires a <strong>source_selections</strong> that is in JSON format. We implemented this in R by first creating a list object and then converting it to JSON using the <strong>toJSON</strong> function from the <strong>jsonlite</strong> package. Let’s take a quick look at what that final JSON parameter looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(params[[<span class="st">'source_selections'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{"year":"2020","level":"2","selected":[]} </code></pre>
</div>
</div>
<p>Now we are ready to submit our API request:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GET request to query API</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url =</span> url, <span class="at">path =</span> endpoint, <span class="at">query =</span> params)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the response status</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">status_code</span>(response) <span class="sc">==</span> <span class="dv">200</span>) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Error:"</span>, <span class="fu">status_code</span>(response)))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># API response as data.frame</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  df_content <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">"text"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_longer</span>(field_values) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(field_values)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The API response contains a more complex JSON object with nested values that our previous API responses did not include. So, we have done a bit of extra data wrangling to get it into a nice data.frame format making use of the <strong>unnest_longer</strong> and <strong>unnest_wider</strong> functions from the <strong>tidyr</strong> package.</p>
<p>Here is the original nested JSON which contains a named list within each element of the <strong>field_values</strong> column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">prettify</span>(<span class="fu">content</span>(response, <span class="st">"text"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No encoding supplied: defaulting to UTF-8.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[
    {
        "field": "freq",
        "field_label": "Time frequency",
        "field_values": [
            {
                "label": "Annual",
                "value": "A"
            }
        ]
    },
    {
        "field": "unit",
        "field_label": "Unit of measure",
        "field_values": [
            {
                "label": "Percentage of total population",
                "value": "PC_POP"
            }
        ]
    }
]
 </code></pre>
</div>
</div>
<p>And, here is our nicely formated data frame which splits those elements into two columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df_content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c9411d0d974fe48fb29f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c9411d0d974fe48fb29f">{"x":{"filter":"none","vertical":false,"data":[["1","2"],["freq","unit"],["Time frequency","Unit of measure"],["Annual","Percentage of total population"],["A","PC_POP"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>field<\/th>\n      <th>field_label<\/th>\n      <th>label<\/th>\n      <th>value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"field","targets":1},{"name":"field_label","targets":2},{"name":"label","targets":3},{"name":"value","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>This response shows us that there are two filters available for this data source, time frequency and unit of measure. In this case, each filter only contains a single option. The data are provided for an Annual (A) time frequency and the unit of measure is Percentage of total population (PC_POP).</p>
<hr>
</section>
<section id="query-data-for-one-data-source" class="level2">
<h2 class="anchored" data-anchor-id="query-data-for-one-data-source">4. Query Data for One Data Source</h2>
<p>In the previous steps, we (1) identified a data source to query, (2) checked which years and geographic levels are available, and (3) identified the filters available. We will now use this information to retrieve the data that we want from our selected data source, <strong>TGS00103</strong>.</p>
<p>To query data from this data source, we will use the API endpoint <a href="https://www.mapineq.org/data-users/#get_x_data">get_x_data</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># API endpoint</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> <span class="st">"functions/postgisftw.get_x_data/items.json"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Endpoint parameters</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">_level</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">_year</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2018</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">X_JSON =</span> <span class="fu">toJSON</span>(<span class="fu">list</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">source =</span> <span class="st">"TGS00103"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">conditions =</span> <span class="fu">list</span>(</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"unit"</span>, <span class="at">value =</span> <span class="st">"PC_POP"</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"freq"</span>, <span class="at">value =</span> <span class="st">"A"</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">auto_unbox =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">limit =</span> <span class="dv">1500</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that the parameters for this endpoint allow us to specify the geographic level (NUTS-2), the year (2018), and provice a JSON object that specifies the resource ID and filters that we want to use to query data. We have also included a parameter to limit the response to no more than 1,500 data points.</p>
<p>Now, let’s submit the API request and format the response as a data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GET request to query API</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url =</span> url, <span class="at">path =</span> endpoint, <span class="at">query =</span> params)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the response status</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">status_code</span>(response) <span class="sc">==</span> <span class="dv">200</span>) {</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Error:"</span>, <span class="fu">status_code</span>(response)))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># API response as data.frame</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  df_content <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">"text"</span>))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df_content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-60cc5556734c589cd6ad" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-60cc5556734c589cd6ad">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332"],["2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018"],["AL01","AL02","AL03","AT11","AT12","AT13","AT21","AT22","AT31","AT32","AT33","AT34","BE10","BE21","BE22","BE23","BE24","BE25","BE31","BE32","BE33","BE34","BE35","BG31","BG32","BG33","BG34","BG41","BG42","CH01","CH02","CH03","CH04","CH05","CH06","CH07","CY00","CZ01","CZ02","CZ03","CZ04","CZ05","CZ06","CZ07","CZ08","DE11","DE12","DE13","DE14","DE21","DE22","DE23","DE24","DE25","DE26","DE27","DE30","DE40","DE50","DE60","DE71","DE72","DE73","DE80","DE91","DE92","DE93","DE94","DEA1","DEA2","DEA3","DEA4","DEA5","DEB1","DEB2","DEB3","DEC0","DED2","DED4","DED5","DEE0","DEF0","DEG0","DK01","DK02","DK03","DK04","DK05","EE00","EL30","EL41","EL42","EL43","EL51","EL52","EL53","EL54","EL61","EL62","EL63","EL64","EL65","ES11","ES12","ES13","ES21","ES22","ES23","ES24","ES30","ES41","ES42","ES43","ES51","ES52","ES53","ES61","ES62","ES63","ES64","ES70","FI19","FI1B","FI1C","FI1D","FI20","FR10","FRB0","FRC1","FRC2","FRD1","FRD2","FRE1","FRE2","FRF1","FRF2","FRF3","FRG0","FRH0","FRI1","FRI2","FRI3","FRJ1","FRJ2","FRK1","FRK2","FRL0","FRM0","FRY1","FRY2","FRY3","FRY4","FRY5","HR03","HR04","HU11","HU12","HU21","HU22","HU23","HU31","HU32","HU33","IE04","IE05","IE06","IS00","ITC1","ITC2","ITC3","ITC4","ITF1","ITF2","ITF3","ITF4","ITF5","ITF6","ITG1","ITG2","ITH1","ITH2","ITH3","ITH4","ITH5","ITI1","ITI2","ITI3","ITI4","LI00","LT01","LT02","LU00","LV00","ME00","MK00","MT00","NL11","NL12","NL13","NL21","NL22","NL23","NL31","NL32","NL33","NL34","NL41","NL42","NO01","NO02","NO03","NO04","NO05","NO06","NO07","PL21","PL22","PL41","PL42","PL43","PL51","PL52","PL61","PL62","PL63","PL71","PL72","PL81","PL82","PL84","PL91","PL92","PT11","PT15","PT16","PT17","PT18","PT20","PT30","RO11","RO12","RO21","RO22","RO31","RO32","RO41","RO42","RS11","RS12","RS21","RS22","SE11","SE12","SE21","SE22","SE23","SE31","SE32","SE33","SI03","SI04","SK01","SK02","SK03","SK04","TR10","TR21","TR22","TR31","TR32","TR33","TR41","TR42","TR51","TR52","TR61","TR62","TR63","TR71","TR72","TR81","TR82","TR83","TR90","TRA1","TRA2","TRB1","TRB2","TRC1","TRC2","TRC3","UKC1","UKC2","UKD1","UKD3","UKD4","UKD6","UKD7","UKE1","UKE2","UKE3","UKE4","UKF1","UKF2","UKF3","UKG1","UKG2","UKG3","UKH1","UKH2","UKH3","UKI3","UKI4","UKI5","UKI6","UKI7","UKJ1","UKJ2","UKJ3","UKJ4","UKK1","UKK2","UKK3","UKK4","UKL1","UKL2","UKM5","UKM6","UKM7","UKM8","UKM9","UKN0"],["Veri","Qender","Jug","Burgenland","Niederösterreich","Wien","Kärnten","Steiermark","Oberösterreich","Salzburg","Tirol","Vorarlberg","Région de Bruxelles-Capitale/ Brussels Hoofdstedelijk Gewest","Prov. Antwerpen","Prov. Limburg (BE)","Prov. Oost-Vlaanderen","Prov. Vlaams-Brabant","Prov. West-Vlaanderen","Prov. Brabant Wallon","Prov. Hainaut","Prov. Liège","Prov. Luxembourg (BE)","Prov. Namur","Severozapaden","Severen tsentralen","Severoiztochen","Yugoiztochen","Yugozapaden","Yuzhen tsentralen","Région lémanique","Espace Mittelland","Nordwestschweiz","Zürich","Ostschweiz","Zentralschweiz","Ticino","Kypros","Praha","Střední Čechy","Jihozápad","Severozápad","Severovýchod","Jihovýchod","Střední Morava","Moravskoslezsko","Stuttgart","Karlsruhe","Freiburg","Tübingen","Oberbayern","Niederbayern","Oberpfalz","Oberfranken","Mittelfranken","Unterfranken","Schwaben","Berlin","Brandenburg","Bremen","Hamburg","Darmstadt","Gießen","Kassel","Mecklenburg-Vorpommern","Braunschweig","Hannover","Lüneburg","Weser-Ems","Düsseldorf","Köln","Münster","Detmold","Arnsberg","Koblenz","Trier","Rheinhessen-Pfalz","Saarland","Dresden","Chemnitz","Leipzig","Sachsen-Anhalt","Schleswig-Holstein","Thüringen","Hovedstaden","Sjælland","Syddanmark","Midtjylland","Nordjylland","Eesti","Attiki","Voreio Aigaio","Notio Aigaio","Kriti","Anatoliki Makedonia, Thraki","Kentriki Makedonia","Dytiki Makedonia","Ipeiros","Thessalia","Ionia Nisia","Dytiki Ellada","Sterea Ellada","Peloponnisos","Galicia","Principado de Asturias","Cantabria","País Vasco","Comunidad Foral de Navarra","La Rioja","Aragón","Comunidad de Madrid","Castilla y León","Castilla-La Mancha","Extremadura","Cataluña","Comunidad Valenciana","Illes Balears","Andalucía","Región de Murcia","Ciudad Autónoma de Ceuta","Ciudad Autónoma de Melilla","Canarias","Länsi-Suomi","Helsinki-Uusimaa","Etelä-Suomi","Pohjois- ja Itä-Suomi","Åland","Ile-de-France","Centre - Val de Loire","Bourgogne","Franche-Comté","Basse-Normandie","Haute-Normandie","Nord-Pas de Calais","Picardie","Alsace","Champagne-Ardenne","Lorraine","Pays de la Loire","Bretagne","Aquitaine","Limousin","Poitou-Charentes","Languedoc-Roussillon","Midi-Pyrénées","Auvergne","Rhône-Alpes","Provence-Alpes-Côte d’Azur","Corse","Guadeloupe","Martinique","Guyane","La Réunion","Mayotte","Jadranska Hrvatska","Kontinentalna Hrvatska","Budapest","Pest","Közép-Dunántúl","Nyugat-Dunántúl","Dél-Dunántúl","Észak-Magyarország","Észak-Alföld","Dél-Alföld","Northern and Western","Southern","Eastern and Midland","Ísland","Piemonte","Valle d'Aosta/Vallée d'Aoste","Liguria","Lombardia","Abruzzo","Molise","Campania","Puglia","Basilicata","Calabria","Sicilia","Sardegna","Provincia Autonoma di Bolzano/Bozen","Provincia Autonoma di Trento","Veneto","Friuli-Venezia Giulia","Emilia-Romagna","Toscana","Umbria","Marche","Lazio","Liechtenstein","Sostinės regionas","Vidurio ir vakarų Lietuvos regionas","Luxembourg","Latvija","Crna Gora","Severna Makedonija","Malta","Groningen","Friesland (NL)","Drenthe","Overijssel","Gelderland","Flevoland","Utrecht","Noord-Holland","Zuid-Holland","Zeeland","Noord-Brabant","Limburg (NL)","Oslo og Akershus","Hedmark og Oppland","Sør-Østlandet","Agder og Rogaland","Vestlandet","Trøndelag","Nord-Norge","Małopolskie","Śląskie","Wielkopolskie","Zachodniopomorskie","Lubuskie","Dolnośląskie","Opolskie","Kujawsko-pomorskie","Warmińsko-mazurskie","Pomorskie","Łódzkie","Świętokrzyskie","Lubelskie","Podkarpackie","Podlaskie","Warszawski stołeczny","Mazowiecki regionalny","Norte","Algarve","Centro (PT)","Área Metropolitana de Lisboa","Alentejo","Região Autónoma dos Açores","Região Autónoma da Madeira","Nord-Vest","Centru","Nord-Est","Sud-Est","Sud - Muntenia","Bucureşti - Ilfov","Sud-Vest Oltenia","Vest","Beogradski region","Region Vojvodine","Region Šumadije i Zapadne Srbije","Region Južne i Istočne Srbije","Stockholm","Östra Mellansverige","Småland med öarna","Sydsverige","Västsverige","Norra Mellansverige","Mellersta Norrland","Övre Norrland","Vzhodna Slovenija","Zahodna Slovenija","Bratislavský kraj","Západné Slovensko","Stredné Slovensko","Východné Slovensko","Istanbul","Tekirdag, Edirne, Kirklareli","Balikesir, Çanakkale","Izmir","Aydin, Denizli, Mugla","Manisa, Afyonkarahisar, Kütahya, Usak","Bursa, Eskisehir, Bilecik","Kocaeli, Sakarya, Düzce, Bolu, Yalova","Ankara","Konya, Karaman","Antalya, Isparta, Burdur","Adana, Mersin","Hatay, Kahramanmaras, Osmaniye","Kirikkale, Aksaray, Nigde, Nevsehir, Kirsehir","Kayseri, Sivas, Yozgat","Zonguldak, Karabük, Bartin","Kastamonu, Çankiri, Sinop","Samsun, Tokat, Çorum, Amasya","Trabzon","Erzurum, Erzincan, Bayburt","Agri, Kars, Igdir, Ardahan","Malatya, Elazig, Bingöl, Tunceli","Van, Mus, Bitlis, Hakkari","Gaziantep, Adiyaman, Kilis","Sanliurfa, Diyarbakir","Mardin, Batman, Sirnak, Siirt","Tees Valley and Durham","Northumberland and Tyne and Wear","Cumbria","Greater Manchester","Lancashire","Cheshire","Merseyside","East Yorkshire and Northern Lincolnshire","North Yorkshire","South Yorkshire","West Yorkshire","Derbyshire and Nottinghamshire","Leicestershire, Rutland and Northamptonshire","Lincolnshire","Herefordshire, Worcestershire and Warwickshire","Shropshire and Staffordshire","West Midlands","East Anglia","Bedfordshire and Hertfordshire","Essex","Inner London - West","Inner London - East","Outer London - East and North East","Outer London - South","Outer London - West and North West","Berkshire, Buckinghamshire and Oxfordshire","Surrey, East and West Sussex","Hampshire and Isle of Wight","Kent","Gloucestershire, Wiltshire and Bristol/Bath area","Dorset and Somerset","Cornwall and Isles of Scilly","Devon","West Wales and The Valleys","East Wales","North Eastern Scotland","Highlands and Islands","Eastern Scotland","West Central Scotland","Southern Scotland","Northern Ireland"],[25.1,23.6,21.6,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,35.1,20.8,23.6,22.5,13.2,27.2,15.8,16.8,16.1,9.6,13.8,11.3,23.9,null,6,7.8,7.7,13.5,9.9,8.699999999999999,11.1,13.1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,15.2,10.8,10.8,11.7,14,null,15.4,20.8,17.5,20.4,21.8,18.9,24.8,20.1,21.6,17.2,24.5,19.1,19,18.8,14,19.9,8.6,8.9,16.6,14.2,16.1,16.1,29.9,37.6,13.6,26,15.4,32,28.6,38.3,21.4,32.1,null,6.9,12.9,16.3,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,18.4,19.7,7.8,7.8,8.5,8.5,18.4,17.3,19.2,16,22.2,15.9,11.7,null,14.2,12,14,11.1,18.7,23.5,41.4,26.8,30.1,32.7,40.7,27.1,9.199999999999999,15.3,11,8.199999999999999,10.1,14.4,12.5,11.7,19.3,null,17,25.3,null,null,null,null,null,19.4,14.2,12,13.2,12.4,13.2,10.6,14,15,12.6,11.2,12.4,13.5,10.1,9.699999999999999,14.6,12.5,13.2,14.6,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,18.6,18.6,18.6,12.3,16.9,31.6,27.5,17.5,19.4,35.6,31.2,25.7,4.1,34.3,14.9,null,null,null,null,12.1,15.1,15.9,23.7,15.9,18.4,17.6,17.3,14.7,11.6,4.3,8.6,15.2,17.1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>best_year<\/th>\n      <th>geo<\/th>\n      <th>geo_name<\/th>\n      <th>x<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":4},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"best_year","targets":1},{"name":"geo","targets":2},{"name":"geo_name","targets":3},{"name":"x","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The response includes the data that we have requested in the <strong>x</strong> column along with identifiers including the geographic unit name (geo_name), NUTS ID (geo), and year (best_year).</p>
<hr>
</section>
<section id="query-data-from-two-sources-joined-by-location" class="level2">
<h2 class="anchored" data-anchor-id="query-data-from-two-sources-joined-by-location">5. Query Data from Two Sources Joined by Location</h2>
<p>Now we want to repeat the same query from our previous step, but this time we will include a second variable joined to the output by geographic location. We will use <strong>Life expectancy by age, sex, and NUTS 2 region</strong> from EuroStat as our second variable. This data has resource ID <strong>DEMO_R_MLIFEXP</strong>, and we will fill in the correct filters following the steps outlined above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># API endpoint</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> <span class="st">"functions/postgisftw.get_xy_data/items.json"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Endpoint parameters</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">_level</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">_year</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2018</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">X_JSON =</span> <span class="fu">toJSON</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">source =</span> <span class="st">"TGS00103"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">conditions =</span> <span class="fu">list</span>(</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"unit"</span>, <span class="at">value =</span> <span class="st">"PC_POP"</span>),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"freq"</span>, <span class="at">value =</span> <span class="st">"A"</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">auto_unbox =</span> <span class="cn">TRUE</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y_JSON =</span> <span class="fu">toJSON</span>(</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">source =</span> <span class="st">"DEMO_R_MLIFEXP"</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">conditions =</span> <span class="fu">list</span>(</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"unit"</span>, <span class="at">value =</span> <span class="st">"YR"</span>),</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"age"</span>, <span class="at">value =</span> <span class="st">"Y_LT1"</span>),</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"sex"</span>, <span class="at">value =</span> <span class="st">"T"</span>),</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">field =</span> <span class="st">"freq"</span>, <span class="at">value =</span> <span class="st">"A"</span>)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">auto_unbox =</span> <span class="cn">TRUE</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">limit =</span> <span class="dv">1500</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co"># GET request to query API</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url =</span> url, <span class="at">path =</span> endpoint, <span class="at">query =</span> params)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the response status</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">status_code</span>(response) <span class="sc">==</span> <span class="dv">200</span>) {</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Error:"</span>, <span class="fu">status_code</span>(response)))</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># API response as data.frame</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  df_content <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">content</span>(response, <span class="st">"text"</span>))</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co"># View data</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(df_content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-9900b734715b576b28dc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9900b734715b576b28dc">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332"],["2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018"],["AL01","AL02","AL03","AT11","AT12","AT13","AT21","AT22","AT31","AT32","AT33","AT34","BE10","BE21","BE22","BE23","BE24","BE25","BE31","BE32","BE33","BE34","BE35","BG31","BG32","BG33","BG34","BG41","BG42","CH01","CH02","CH03","CH04","CH05","CH06","CH07","CY00","CZ01","CZ02","CZ03","CZ04","CZ05","CZ06","CZ07","CZ08","DE11","DE12","DE13","DE14","DE21","DE22","DE23","DE24","DE25","DE26","DE27","DE30","DE40","DE50","DE60","DE71","DE72","DE73","DE80","DE91","DE92","DE93","DE94","DEA1","DEA2","DEA3","DEA4","DEA5","DEB1","DEB2","DEB3","DEC0","DED2","DED4","DED5","DEE0","DEF0","DEG0","DK01","DK02","DK03","DK04","DK05","EE00","EL30","EL41","EL42","EL43","EL51","EL52","EL53","EL54","EL61","EL62","EL63","EL64","EL65","ES11","ES12","ES13","ES21","ES22","ES23","ES24","ES30","ES41","ES42","ES43","ES51","ES52","ES53","ES61","ES62","ES63","ES64","ES70","FI19","FI1B","FI1C","FI1D","FI20","FR10","FRB0","FRC1","FRC2","FRD1","FRD2","FRE1","FRE2","FRF1","FRF2","FRF3","FRG0","FRH0","FRI1","FRI2","FRI3","FRJ1","FRJ2","FRK1","FRK2","FRL0","FRM0","FRY1","FRY2","FRY3","FRY4","FRY5","HR03","HR04","HU11","HU12","HU21","HU22","HU23","HU31","HU32","HU33","IE04","IE05","IE06","IS00","ITC1","ITC2","ITC3","ITC4","ITF1","ITF2","ITF3","ITF4","ITF5","ITF6","ITG1","ITG2","ITH1","ITH2","ITH3","ITH4","ITH5","ITI1","ITI2","ITI3","ITI4","LI00","LT01","LT02","LU00","LV00","ME00","MK00","MT00","NL11","NL12","NL13","NL21","NL22","NL23","NL31","NL32","NL33","NL34","NL41","NL42","NO01","NO02","NO03","NO04","NO05","NO06","NO07","PL21","PL22","PL41","PL42","PL43","PL51","PL52","PL61","PL62","PL63","PL71","PL72","PL81","PL82","PL84","PL91","PL92","PT11","PT15","PT16","PT17","PT18","PT20","PT30","RO11","RO12","RO21","RO22","RO31","RO32","RO41","RO42","RS11","RS12","RS21","RS22","SE11","SE12","SE21","SE22","SE23","SE31","SE32","SE33","SI03","SI04","SK01","SK02","SK03","SK04","TR10","TR21","TR22","TR31","TR32","TR33","TR41","TR42","TR51","TR52","TR61","TR62","TR63","TR71","TR72","TR81","TR82","TR83","TR90","TRA1","TRA2","TRB1","TRB2","TRC1","TRC2","TRC3","UKC1","UKC2","UKD1","UKD3","UKD4","UKD6","UKD7","UKE1","UKE2","UKE3","UKE4","UKF1","UKF2","UKF3","UKG1","UKG2","UKG3","UKH1","UKH2","UKH3","UKI3","UKI4","UKI5","UKI6","UKI7","UKJ1","UKJ2","UKJ3","UKJ4","UKK1","UKK2","UKK3","UKK4","UKL1","UKL2","UKM5","UKM6","UKM7","UKM8","UKM9","UKN0"],["Veri","Qender","Jug","Burgenland","Niederösterreich","Wien","Kärnten","Steiermark","Oberösterreich","Salzburg","Tirol","Vorarlberg","Région de Bruxelles-Capitale/ Brussels Hoofdstedelijk Gewest","Prov. Antwerpen","Prov. Limburg (BE)","Prov. Oost-Vlaanderen","Prov. Vlaams-Brabant","Prov. West-Vlaanderen","Prov. Brabant Wallon","Prov. Hainaut","Prov. Liège","Prov. Luxembourg (BE)","Prov. Namur","Severozapaden","Severen tsentralen","Severoiztochen","Yugoiztochen","Yugozapaden","Yuzhen tsentralen","Région lémanique","Espace Mittelland","Nordwestschweiz","Zürich","Ostschweiz","Zentralschweiz","Ticino","Kypros","Praha","Střední Čechy","Jihozápad","Severozápad","Severovýchod","Jihovýchod","Střední Morava","Moravskoslezsko","Stuttgart","Karlsruhe","Freiburg","Tübingen","Oberbayern","Niederbayern","Oberpfalz","Oberfranken","Mittelfranken","Unterfranken","Schwaben","Berlin","Brandenburg","Bremen","Hamburg","Darmstadt","Gießen","Kassel","Mecklenburg-Vorpommern","Braunschweig","Hannover","Lüneburg","Weser-Ems","Düsseldorf","Köln","Münster","Detmold","Arnsberg","Koblenz","Trier","Rheinhessen-Pfalz","Saarland","Dresden","Chemnitz","Leipzig","Sachsen-Anhalt","Schleswig-Holstein","Thüringen","Hovedstaden","Sjælland","Syddanmark","Midtjylland","Nordjylland","Eesti","Attiki","Voreio Aigaio","Notio Aigaio","Kriti","Anatoliki Makedonia, Thraki","Kentriki Makedonia","Dytiki Makedonia","Ipeiros","Thessalia","Ionia Nisia","Dytiki Ellada","Sterea Ellada","Peloponnisos","Galicia","Principado de Asturias","Cantabria","País Vasco","Comunidad Foral de Navarra","La Rioja","Aragón","Comunidad de Madrid","Castilla y León","Castilla-La Mancha","Extremadura","Cataluña","Comunidad Valenciana","Illes Balears","Andalucía","Región de Murcia","Ciudad Autónoma de Ceuta","Ciudad Autónoma de Melilla","Canarias","Länsi-Suomi","Helsinki-Uusimaa","Etelä-Suomi","Pohjois- ja Itä-Suomi","Åland","Ile-de-France","Centre - Val de Loire","Bourgogne","Franche-Comté","Basse-Normandie","Haute-Normandie","Nord-Pas de Calais","Picardie","Alsace","Champagne-Ardenne","Lorraine","Pays de la Loire","Bretagne","Aquitaine","Limousin","Poitou-Charentes","Languedoc-Roussillon","Midi-Pyrénées","Auvergne","Rhône-Alpes","Provence-Alpes-Côte d’Azur","Corse","Guadeloupe","Martinique","Guyane","La Réunion","Mayotte","Jadranska Hrvatska","Kontinentalna Hrvatska","Budapest","Pest","Közép-Dunántúl","Nyugat-Dunántúl","Dél-Dunántúl","Észak-Magyarország","Észak-Alföld","Dél-Alföld","Northern and Western","Southern","Eastern and Midland","Ísland","Piemonte","Valle d'Aosta/Vallée d'Aoste","Liguria","Lombardia","Abruzzo","Molise","Campania","Puglia","Basilicata","Calabria","Sicilia","Sardegna","Provincia Autonoma di Bolzano/Bozen","Provincia Autonoma di Trento","Veneto","Friuli-Venezia Giulia","Emilia-Romagna","Toscana","Umbria","Marche","Lazio","Liechtenstein","Sostinės regionas","Vidurio ir vakarų Lietuvos regionas","Luxembourg","Latvija","Crna Gora","Severna Makedonija","Malta","Groningen","Friesland (NL)","Drenthe","Overijssel","Gelderland","Flevoland","Utrecht","Noord-Holland","Zuid-Holland","Zeeland","Noord-Brabant","Limburg (NL)","Oslo og Akershus","Hedmark og Oppland","Sør-Østlandet","Agder og Rogaland","Vestlandet","Trøndelag","Nord-Norge","Małopolskie","Śląskie","Wielkopolskie","Zachodniopomorskie","Lubuskie","Dolnośląskie","Opolskie","Kujawsko-pomorskie","Warmińsko-mazurskie","Pomorskie","Łódzkie","Świętokrzyskie","Lubelskie","Podkarpackie","Podlaskie","Warszawski stołeczny","Mazowiecki regionalny","Norte","Algarve","Centro (PT)","Área Metropolitana de Lisboa","Alentejo","Região Autónoma dos Açores","Região Autónoma da Madeira","Nord-Vest","Centru","Nord-Est","Sud-Est","Sud - Muntenia","Bucureşti - Ilfov","Sud-Vest Oltenia","Vest","Beogradski region","Region Vojvodine","Region Šumadije i Zapadne Srbije","Region Južne i Istočne Srbije","Stockholm","Östra Mellansverige","Småland med öarna","Sydsverige","Västsverige","Norra Mellansverige","Mellersta Norrland","Övre Norrland","Vzhodna Slovenija","Zahodna Slovenija","Bratislavský kraj","Západné Slovensko","Stredné Slovensko","Východné Slovensko","Istanbul","Tekirdag, Edirne, Kirklareli","Balikesir, Çanakkale","Izmir","Aydin, Denizli, Mugla","Manisa, Afyonkarahisar, Kütahya, Usak","Bursa, Eskisehir, Bilecik","Kocaeli, Sakarya, Düzce, Bolu, Yalova","Ankara","Konya, Karaman","Antalya, Isparta, Burdur","Adana, Mersin","Hatay, Kahramanmaras, Osmaniye","Kirikkale, Aksaray, Nigde, Nevsehir, Kirsehir","Kayseri, Sivas, Yozgat","Zonguldak, Karabük, Bartin","Kastamonu, Çankiri, Sinop","Samsun, Tokat, Çorum, Amasya","Trabzon","Erzurum, Erzincan, Bayburt","Agri, Kars, Igdir, Ardahan","Malatya, Elazig, Bingöl, Tunceli","Van, Mus, Bitlis, Hakkari","Gaziantep, Adiyaman, Kilis","Sanliurfa, Diyarbakir","Mardin, Batman, Sirnak, Siirt","Tees Valley and Durham","Northumberland and Tyne and Wear","Cumbria","Greater Manchester","Lancashire","Cheshire","Merseyside","East Yorkshire and Northern Lincolnshire","North Yorkshire","South Yorkshire","West Yorkshire","Derbyshire and Nottinghamshire","Leicestershire, Rutland and Northamptonshire","Lincolnshire","Herefordshire, Worcestershire and Warwickshire","Shropshire and Staffordshire","West Midlands","East Anglia","Bedfordshire and Hertfordshire","Essex","Inner London - West","Inner London - East","Outer London - East and North East","Outer London - South","Outer London - West and North West","Berkshire, Buckinghamshire and Oxfordshire","Surrey, East and West Sussex","Hampshire and Isle of Wight","Kent","Gloucestershire, Wiltshire and Bristol/Bath area","Dorset and Somerset","Cornwall and Isles of Scilly","Devon","West Wales and The Valleys","East Wales","North Eastern Scotland","Highlands and Islands","Eastern Scotland","West Central Scotland","Southern Scotland","Northern Ireland"],[25.1,23.6,21.6,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,35.1,20.8,23.6,22.5,13.2,27.2,15.8,16.8,16.1,9.6,13.8,11.3,23.9,null,6,7.8,7.7,13.5,9.9,8.699999999999999,11.1,13.1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,15.2,10.8,10.8,11.7,14,null,15.4,20.8,17.5,20.4,21.8,18.9,24.8,20.1,21.6,17.2,24.5,19.1,19,18.8,14,19.9,8.6,8.9,16.6,14.2,16.1,16.1,29.9,37.6,13.6,26,15.4,32,28.6,38.3,21.4,32.1,null,6.9,12.9,16.3,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,18.4,19.7,7.8,7.8,8.5,8.5,18.4,17.3,19.2,16,22.2,15.9,11.7,null,14.2,12,14,11.1,18.7,23.5,41.4,26.8,30.1,32.7,40.7,27.1,9.199999999999999,15.3,11,8.199999999999999,10.1,14.4,12.5,11.7,19.3,null,17,25.3,null,null,null,null,null,19.4,14.2,12,13.2,12.4,13.2,10.6,14,15,12.6,11.2,12.4,13.5,10.1,9.699999999999999,14.6,12.5,13.2,14.6,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,18.6,18.6,18.6,12.3,16.9,31.6,27.5,17.5,19.4,35.6,31.2,25.7,4.1,34.3,14.9,null,null,null,null,12.1,15.1,15.9,23.7,15.9,18.4,17.6,17.3,14.7,11.6,4.3,8.6,15.2,17.1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,81.5,81.5,80.59999999999999,81.59999999999999,82.2,82.2,82.90000000000001,83,82.90000000000001,81.5,82.5,83.09999999999999,82.3,83,82.59999999999999,82.7,79.09999999999999,80,80.59999999999999,79.90000000000001,73.59999999999999,74.40000000000001,74.7,74.40000000000001,75.90000000000001,75.5,84.2,83.3,83.90000000000001,84,83.59999999999999,84,85.2,82.90000000000001,80.8,79,79.2,77.2,79.40000000000001,79.7,79.09999999999999,78,82.3,81.7,82.2,82.5,82.7,81.09999999999999,80.90000000000001,80.59999999999999,81,81.59999999999999,82.09999999999999,80.8,80.7,79.7,81.09999999999999,81.8,80.90000000000001,80.8,79.90000000000001,80.3,80.5,80.59999999999999,80.5,80.3,80.90000000000001,80.8,81.09999999999999,80,80.7,80.90000000000001,81,79.7,81.5,80.5,80.59999999999999,79.40000000000001,80.40000000000001,80.3,81.09999999999999,80.40000000000001,81.09999999999999,81.3,80.8,78.5,81.3,82.90000000000001,82.7,82.59999999999999,81.40000000000001,81.90000000000001,83,83.59999999999999,82.59999999999999,81.3,81.7,82.3,82.09999999999999,83.5,82.90000000000001,83.59999999999999,84.09999999999999,84.40000000000001,83.90000000000001,83.8,85.5,84.3,83.8,82.8,83.7,82.90000000000001,83.59999999999999,82.09999999999999,83,81.5,80.7,82.59999999999999,82,82.5,81.5,81.09999999999999,83.40000000000001,84.40000000000001,82.7,82.3,82.5,82.3,81.59999999999999,80.59999999999999,81.2,82.7,81.59999999999999,81.90000000000001,83.3,82.2,83.3,82.40000000000001,82.7,82.59999999999999,83.7,82.5,84.09999999999999,83.40000000000001,84.2,null,82.59999999999999,null,81,76.09999999999999,79.40000000000001,77.59999999999999,78.40000000000001,76.40000000000001,75.90000000000001,76.7,75.90000000000001,74.40000000000001,75.5,76.2,82.59999999999999,81.7,82.5,82.90000000000001,83,82.3,83.09999999999999,84,83.59999999999999,83.3,81.90000000000001,83.59999999999999,83.09999999999999,83,82.3,83.8,84.40000000000001,84.59999999999999,84,83.5,83.90000000000001,84,84.3,84.40000000000001,83.59999999999999,83.09999999999999,76.3,75.90000000000001,82.3,75.09999999999999,76.90000000000001,76.7,82.5,81,81.7,81.59999999999999,81.7,81.8,81.90000000000001,82.40000000000001,82.09999999999999,81.90000000000001,82.09999999999999,81.90000000000001,81.8,83.40000000000001,81.7,82.59999999999999,82.40000000000001,83.40000000000001,83,82.2,79.09999999999999,77.2,77.59999999999999,77.3,76.90000000000001,77.2,78,77.2,76.90000000000001,78.2,76.3,77.7,77.8,79.40000000000001,78.2,79.09999999999999,76.8,82,80.3,81.8,81.7,80.8,78.09999999999999,78.7,75.2,75.8,74.09999999999999,74.5,75.3,76.90000000000001,76.09999999999999,75.40000000000001,77,75.2,76.3,75.3,83,82.5,82.8,82.5,82.7,82.2,82,81.7,80.5,82.7,78.8,77.40000000000001,77.09999999999999,77.2,79.40000000000001,77.8,78.3,79.2,79.59999999999999,77.7,78.40000000000001,78.5,79.59999999999999,78.8,79.7,78.7,79.09999999999999,78.7,78.7,78.2,78.7,78.90000000000001,80.59999999999999,78.8,78,80.09999999999999,78.40000000000001,78.09999999999999,79.40000000000001,null,79.8,79.90000000000001,81.59999999999999,80,79.90000000000001,81.90000000000001,79.59999999999999,80.8,82.3,80.2,80.09999999999999,80.90000000000001,81.5,81,81.90000000000001,80.90000000000001,80.2,82.3,82.3,81.8,84.7,82,82.40000000000001,82.7,83.40000000000001,83.2,82.90000000000001,82.5,81.59999999999999,82.3,82.40000000000001,81.40000000000001,81.90000000000001,80,81,80.3,80,79.90000000000001,77.90000000000001,79.2,80.90000000000001]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>best_year<\/th>\n      <th>geo<\/th>\n      <th>geo_name<\/th>\n      <th>x<\/th>\n      <th>y<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[4,5]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"best_year","targets":1},{"name":"geo","targets":2},{"name":"geo_name","targets":3},{"name":"x","targets":4},{"name":"y","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The <strong>x</strong> column contains the variable defined by the parameter <strong>X_JSON</strong> and the <strong>y</strong> column contains the variable defined by the <strong>Y_JSON</strong> parameter.</p>
<hr>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This tutorial provided a step-by-step guide to querying the Mapineq API using R. The code examples demonstrate how to retrieve data for various endpoints and how to process the responses into usable formats. For further details, consult the Mapineq API documentation available from <a href="https://mapineq.org/data-users">https://mapineq.org/data-users</a>.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>